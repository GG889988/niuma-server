<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ç‰›é©¬å¾—é—²Â·å†…æµ‹ç‰ˆ</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: #fdf8f0;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .post-form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .post-form input, .post-form textarea {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #eee;
      border-radius: 8px;
      box-sizing: border-box;
    }
    .post-form button {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    .post {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 15px;
    }
    .post h4 {
      margin: 0 0 10px;
      color: #8b4513;
    }
    .post button {
      background: none;
      border: none;
      color: #ff6b6b;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ„ğŸ ç‰›é©¬å¾—é—²Â·å†…æµ‹ç‰ˆ</h1>
    <p>ä½ çš„åŒ¿åå–˜æ¯ç©ºé—´</p>
  </div>

  <!-- å‘å¸ƒæ–°å¸–å­è¡¨å• -->
  <div class="post-form">
    <h3>å‘å¸ƒæ–°å¸–å­</h3>
    <input type="text" id="postName" placeholder="ä½ çš„æ˜µç§°ï¼ˆå¯é€‰ï¼‰">
    <textarea id="postText" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." rows="3"></textarea>
    <button onclick="submitPost()">å‘å¸ƒ</button>
  </div>

  <!-- å¸–å­åˆ—è¡¨å®¹å™¨ -->
  <div id="postsList"></div>

  <script>
    // åç«¯æ¥å£åœ°å€
    const apiUrl = 'https://niuma-server-production.up.railway.app/api/posts';

    // åŠ è½½æ‰€æœ‰å¸–å­
    async function loadPosts() {
      try {
        const response = await fetch(apiUrl);
        const data = await response.json();
        if (data.success) {
          renderPosts(data.data);
        }
      } catch (err) {
        console.error('åŠ è½½å¸–å­å¤±è´¥:', err);
      }
    }

    // æ¸²æŸ“å¸–å­åˆ—è¡¨
    function renderPosts(posts) {
      const list = document.getElementById('postsList');
      if (posts.length === 0) {
        list.innerHTML = '<p style="text-align:center">è¿˜æ²¡æœ‰å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡å§ï½</p>';
        return;
      }
      list.innerHTML = posts.map(post => `
        <div class="post">
          <h4>${post.name || 'åŒ¿åç”¨æˆ·'}</h4>
          <p>${post.text}</p>
          <button onclick="likePost(${post.id})">ğŸ‘ ${post.likes || 0} æ¬¡å…±é¸£</button>
        </div>
      `).join('');
    }

    // å‘å¸ƒæ–°å¸–å­
    async function submitPost() {
      const name = document.getElementById('postName').value.trim();
      const text = document.getElementById('postText').value.trim();
      
      if (!text) {
        alert('å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦ï½');æç¤º('å†…å®¹ä¸èƒ½ä¸ºç©ºå“¦ï½');
        return;è¿”å›;
      }

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: name || 'åŒ¿åç”¨æˆ·', text })
        });
        const data = await response.json();
        if (data.success) {
          // æ¸…ç©ºè¾“å…¥æ¡†
          document.getElementById('postName').value = '';
          document.getElementById('postText').value = '';
          // é‡æ–°åŠ è½½å¸–å­
          loadPosts();
          alert('å‘å¸ƒæˆåŠŸï¼');è­¦æŠ¥('å‘å¸ƒæˆåŠŸï¼');
        } else {
          alert('å‘å¸ƒå¤±è´¥ï¼š' + (data.message || 'æœªçŸ¥é”™è¯¯'));è­¦æŠ¥('å‘å¸ƒå¤±è´¥ï¼š' + (data.messageæ¶ˆæ¯ || 'æœªçŸ¥é”™è¯¯'));
        }
      } catch (err) {
        console.error('å‘å¸ƒå¸–å­å¤±è´¥:', err);
        alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œï½');
      }
    }

    // ç‚¹èµå¸–å­
    async function likePost(postId) {
      try {
        const response = await fetch(`${apiUrl}/${postId}/like`, {
          method: 'PUT'
        });
        const data = await response.json();
        if (data.success) {
          loadPosts(); // åˆ·æ–°åˆ—è¡¨
        }
      } catch (err) {
        console.error('ç‚¹èµå¤±è´¥:', err);
        alert('ç‚¹èµå¤±è´¥ï¼Œè¯·é‡è¯•ï½');
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½å¸–å­
    window.onload = loadPosts;
  </script>
</body>
</html>
